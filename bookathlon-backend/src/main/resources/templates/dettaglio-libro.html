<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="it">
<head>
  <meta charset="UTF-8">
  <title th:text="${libro.titolo}">Titolo libro</title>
  <link rel="stylesheet" th:href="@{/css/home.css}">
</head>
<body>

<header>
  <div class="header-content">
    <div class="logo">
      <a th:href="@{/}">
        <img th:src="@{/images/logoverde.png}" alt="Bookathlon Logo" />
      </a>
    </div>
  </div>
</header>

<main>
  <div class="user-greeting-box">
    <h1 th:text="${libro.titolo}">Titolo</h1>
    <img th:src="${libro.url_copertina}" alt="Copertina libro" style="max-width:200px; margin:1rem auto;" />
    <p><strong>Autore:</strong> <span th:text="${libro.autore}">Autore</span></p>
    <p><strong>Genere:</strong> <span th:text="${libro.genere}">Genere</span></p>
    <p><strong>Data pubblicazione:</strong> <span th:text="${libro.data_pubblicazione}">Data</span></p>
    <p><strong>Descrizione:</strong></p><p th:text="${libro.descrizione}">Trama libro</p>
    <p><strong>ISBN:</strong> <span th:text="${libro.isbn}">ISBN</span></p>
    <a href="/" class="nav-btn">Torna alla Home</a>
  </div>
</main>

<!-- FORM COMMENTO -->
<section class="card-section-wrapper" style="max-width: 600px; margin: 2rem auto;">
  <h2>Scrivi un commento</h2>
  <form th:action="@{/libro/commenta}" method="post">
    <input type="hidden" name="libroId" th:value="${libro.id}" />
    <textarea name="contenuto" placeholder="Scrivi qui il tuo commento..." required
              style="width: 100%; height: 100px; padding: 0.5rem; margin-bottom: 1rem;"></textarea>
    <button type="submit" class="nav-btn">Invia Commento</button>
  </form>
</section>

<!-- LISTA COMMENTI -->
<section class="card-section-wrapper" style="max-width: 600px; margin: 2rem auto;">
  <h2>Commenti</h2>
  
  <div th:if="${commenti.size() == 0}">
    <p>Nessun commento per questo libro.</p>
  </div>

  <div th:each="c : ${commenti}" class="card" style="margin-bottom: 1rem; position: relative;">
    <p><strong th:text="'Utente #' + ${c.utenteId}">Utente</strong></p>
    <p th:text="${c.contenuto}">Testo del commento</p>
    <p style="font-size: 0.8rem; color: #aaa;" th:text="${#temporals.format(c.dataCreazione, 'dd/MM/yyyy HH:mm')}">Data</p>

    <!-- SEZIONE LIKE -->
    <div style="position: absolute; top: 1rem; right: 1rem;">
      <span th:text="${likeService.contaLike(c.id)} + ' ❤️'">0 ❤️</span>

      <form th:if="${#authorization.expression('isAuthenticated()')}" 
            th:action="@{/libro/commento/like}" method="post" style="display:inline">
        <input type="hidden" name="commentoId" th:value="${c.id}" />
        <button type="submit" 
                th:text="${likeService.haGiaMessoLike(c.id, utenteLoggatoId) ? 'Dislike' : 'Like'}" 
                class="nav-btn" 
                style="margin-left: 0.5rem;"></button>
      </form>
    </div>
  </div>
</section>

</body>
</html>